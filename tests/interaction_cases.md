# 用户与AI交互案例设计

## 案例1：创建新项目

### 用户输入
```
创建一个名为"产品开发"的新项目，描述为"开发新一代智能产品"，包含3个任务：需求分析、原型设计、代码开发。
```

### 系统信息收集过程
1. **理解用户需求**
   - 分析用户消息，识别出需要创建新项目
   - 提取项目名称："产品开发"
   - 提取项目描述："开发新一代智能产品"
   - 提取任务信息：3个任务（需求分析、原型设计、代码开发）

2. **查询项目信息**
   - 从数据库中获取现有项目列表
   - 从数据库中获取现有类别列表
   - 确认"产品开发"项目不存在

3. **调用LLM生成回复**
   - 构建上下文，包含用户消息和系统提示
   - 调用大语言模型生成智能回复
   - 生成确认信息，询问用户是否执行

4. **解析LLM响应**
   - 分析LLM回复，提取自然语言内容
   - 确认当前阶段为确认轮，不需要执行操作

5. **执行操作**
   - 当前为确认轮，不执行操作

6. **生成最终回复**
   - 生成确认提示，询问用户是否确认执行

### AI回复（第一轮）
```
我将创建一个名为"产品开发"的新项目，描述为"开发新一代智能产品"，并添加3个任务：需求分析、原型设计、代码开发。确认执行吗？
```

### 用户确认
```
确认
```

### 系统信息收集过程（第二轮）
1. **理解用户需求**
   - 分析用户消息，识别出用户确认执行

2. **查询项目信息**
   - 再次确认"产品开发"项目不存在

3. **调用LLM生成回复**
   - 构建上下文，包含用户确认消息
   - 调用大语言模型生成执行回复
   - 生成包含JSON指令的回复

4. **解析LLM响应**
   - 分析LLM回复，提取JSON指令
   - 解析出create_project意图和相关数据

5. **执行操作**
   - 执行创建项目操作
   - 添加3个任务

6. **生成最终回复**
   - 整合操作结果，生成成功提示

### AI回复（第二轮）
```
项目创建成功！

我已成功创建了名为"产品开发"的新项目，并添加了以下任务：
- 需求分析
- 原型设计
- 代码开发

项目描述：开发新一代智能产品

```json
{
  "intent": "create_project",
  "data": {
    "project_name": "产品开发",
    "description": "开发新一代智能产品",
    "tasks": [
      {
        "name": "需求分析",
        "assignee": "",
        "start_date": "",
        "end_date": "",
        "priority": "medium"
      },
      {
        "name": "原型设计",
        "assignee": "",
        "start_date": "",
        "end_date": "",
        "priority": "medium"
      },
      {
        "name": "代码开发",
        "assignee": "",
        "start_date": "",
        "end_date": "",
        "priority": "medium"
      }
    ]
  }
}
```
```

操作结果: 项目创建成功
```

## 案例2：查询项目信息

### 用户输入
```
查询"产品开发"项目的信息
```

### 系统信息收集过程
1. **理解用户需求**
   - 分析用户消息，识别出需要查询项目信息
   - 提取项目名称："产品开发"

2. **查询项目信息**
   - 从数据库中查询"产品开发"项目
   - 获取项目详细信息，包括任务列表

3. **调用LLM生成回复**
   - 构建上下文，包含用户消息和项目信息
   - 调用大语言模型生成智能回复

4. **解析LLM响应**
   - 分析LLM回复，提取自然语言内容
   - 解析出query_project意图

5. **执行操作**
   - 执行查询项目操作
   - 获取最新的项目信息

6. **生成最终回复**
   - 整合项目信息，生成详细的回复

### AI回复
```
以下是"产品开发"项目的详细信息：

项目名称：产品开发
项目描述：开发新一代智能产品
创建时间：2024-01-01
进度：0%
状态：进行中

任务列表：
- 需求分析（待开始）
- 原型设计（待开始）
- 代码开发（待开始）

```json
{
  "intent": "query_project",
  "data": {
    "project_name": "产品开发"
  }
}
```
```

项目信息: 项目查询成功
进度: 0%
状态: 进行中
```

## 案例3：为项目添加类别

### 用户输入
```
将"产品开发"项目添加到"研发"类别中
```

### 系统信息收集过程
1. **理解用户需求**
   - 分析用户消息，识别出需要为项目添加类别
   - 提取项目名称："产品开发"
   - 提取类别名称："研发"

2. **查询项目信息**
   - 从数据库中查询"产品开发"项目
   - 从数据库中查询"研发"类别
   - 确认项目存在，类别不存在

3. **调用LLM生成回复**
   - 构建上下文，包含用户消息和查询结果
   - 调用大语言模型生成智能回复
   - 生成需要创建类别并分配的确认信息

4. **解析LLM响应**
   - 分析LLM回复，提取自然语言内容
   - 确认当前阶段为确认轮

5. **执行操作**
   - 当前为确认轮，不执行操作

6. **生成最终回复**
   - 生成确认提示，询问用户是否确认执行

### AI回复（第一轮）
```
我将创建"研发"类别，然后将"产品开发"项目添加到该类别中。确认执行吗？
```

### 用户确认
```
确认
```

### 系统信息收集过程（第二轮）
1. **理解用户需求**
   - 分析用户消息，识别出用户确认执行

2. **查询项目信息**
   - 再次确认项目存在，类别不存在

3. **调用LLM生成回复**
   - 构建上下文，包含用户确认消息
   - 调用大语言模型生成执行回复
   - 生成包含JSON指令的回复

4. **解析LLM响应**
   - 分析LLM回复，提取JSON指令
   - 解析出create_category和assign_category意图

5. **执行操作**
   - 执行创建类别操作
   - 执行为项目分配类别操作

6. **生成最终回复**
   - 整合操作结果，生成成功提示

### AI回复（第二轮）
```
操作执行成功！

我已成功创建了"研发"类别，并将"产品开发"项目添加到该类别中。

```json
{
  "intent": "create_category",
  "data": {
    "category_name": "研发",
    "description": "研发相关项目"
  }
}
```

```json
{
  "intent": "assign_category",
  "data": {
    "project_name": "产品开发",
    "category_name": "研发"
  }
}
```
```

操作结果: 类别创建成功
操作结果: 项目已成功分配到类别
```
