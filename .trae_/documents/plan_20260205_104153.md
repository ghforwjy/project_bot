# 甘特图项目筛选功能修改计划

## 问题分析

当前甘特图的项目筛选功能使用两个下拉框：
1. "视图模式"下拉框（包含"所有项目"和"单个项目"选项）
2. "选择项目"下拉框（仅在选择"单个项目"时显示，包含数据库中的项目列表）

## 需求

将筛选功能改为一个统一的下拉框，包含：
- "所有项目"选项
- 从数据库查询的项目名列表

根据选中的项目进行筛选。

## 实现方案

### 1. 修改状态管理
- 移除 `viewMode` 和 `selectedProjectId` 状态
- 添加新的 `selectedProject` 状态，类型为 `number | null`，其中 `null` 表示"所有项目"

### 2. 修改控制栏组件
- 移除原有的"视图模式"和"选择项目"下拉框
- 添加新的"项目"下拉框，包含：
  - "所有项目"选项（值为 `null`）
  - 数据库中的项目列表（值为项目ID）

### 3. 修改筛选逻辑
- 更新 `filteredCategories` 的计算逻辑，使其根据 `selectedProject` 状态过滤项目
- 当 `selectedProject` 为 `null` 时，显示所有项目
- 当 `selectedProject` 为具体项目ID时，只显示该项目

### 4. 具体修改

**修改文件：** `frontend/src/components/gantt/GanttChart.tsx`

1. **状态管理修改：**
   - 替换 `viewMode` 和 `selectedProjectId` 状态
   - 添加 `selectedProject` 状态

2. **控制栏修改：**
   - 移除原有的两个下拉框
   - 添加新的项目选择下拉框

3. **筛选逻辑修改：**
   - 更新 `filteredCategories` 的过滤条件

### 5. 预期效果

- 界面上只有一个"项目"下拉框
- 下拉框包含"所有项目"选项和数据库中的项目列表
- 选择"所有项目"时显示所有项目
- 选择具体项目时只显示该项目

## 技术要点

- 使用 `useMemo` 优化项目列表的计算
- 保持与原有筛选逻辑的兼容性
- 确保UI设计与现有控制栏风格一致