# 甘特图任务状态刷新问题分析与解决方案

## 问题分析

通过分析代码，发现甘特图任务状态不刷新的根本原因是：

1. **数据缓存问题**：甘特图组件使用React Query获取数据，查询键为`['gantt', projectId || 'all']`，但在任务修改后没有失效这个缓存

2. **更新流程缺失**：TaskModal组件的updateTaskMutation在成功修改任务后，只关闭了模态框并显示成功消息，没有触发甘特图数据的重新获取

## 解决方案

在TaskModal组件的updateTaskMutation的onSuccess回调中添加缓存失效逻辑，具体修改如下：

1. **导入queryClient**：在TaskModal.tsx中导入useQueryClient钩子

2. **获取queryClient实例**：在组件中创建queryClient实例

3. **添加缓存失效**：在updateTaskMutation的onSuccess回调中，添加对甘特图数据缓存的失效处理

4. **扩展到创建任务**：同样在createTaskMutation的onSuccess回调中添加相同的缓存失效逻辑

## 修改范围

只需要修改以下文件：
- `frontend/src/components/project/TaskModal.tsx`

具体修改点：
1. 导入useQueryClient
2. 在组件中获取queryClient实例
3. 在createTaskMutation和updateTaskMutation的onSuccess回调中添加缓存失效代码

这样修改后，当用户修改任务状态并返回甘特图页面时，React Query会自动重新获取最新的数据，甘特图上的任务状态就会正确刷新。