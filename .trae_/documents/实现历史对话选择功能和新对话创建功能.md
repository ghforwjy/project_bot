# 实现历史对话选择功能和新对话创建功能

## 一、历史对话选择功能详细设计

### 1.1 布局设计

**选择栏布局（位于历史对话抽屉顶部）**
- 高度：48px
- 内边距：12px 16px
- 背景色：`#F5F5F5` (gray-100)
- 边框：底部边框 `1px solid #E5E7EB` (border-gray-200)
- Flex布局：`justify-between items-center`

**选择栏内容**
- 左侧：全选复选框 + 文本"已选择 X 项"
  - 复选框尺寸：16px × 16px
  - 文本字体：14px (text-sm)
  - 文本颜色：`#374151` (text-gray-700)
  - 间距：复选框与文本间距 8px
- 右侧：批量删除按钮
  - 按钮高度：32px
  - 按钮宽度：自适应（最小宽度80px）
  - 内边距：6px 12px
  - 背景色：`#EF4444` (red-500)
  - 文字颜色：`#FFFFFF` (white)
  - 圆角：6px
  - 字体大小：14px
  - 字体粗细：500 (font-medium)
  - 悬停状态：背景色 `#DC2626` (red-600)
  - 过渡时长：200ms
  - 光标：`pointer`
  - 禁用状态：背景色 `#FCA5A5` (red-300)，文字颜色 `#FCA5A5`

**会话项布局**
- 每个会话项高度：64px
- 内边距：12px 16px
- Flex布局：`items-center gap-3`
- 边框：底部边框 `1px solid #E5E7EB` (border-gray-200)
- 悬停状态：背景色 `#F9FAFB` (gray-50)
- 过渡时长：200ms
- 光标：`pointer`

**会话项内容**
- 左侧：复选框
  - 尺寸：16px × 16px
  - 边框：`1px solid #D1D5DB` (border-gray-300)
  - 选中状态：背景色 `#3B82F6` (blue-500)，边框 `#3B82F6`
  - 悬停状态：边框 `#9CA3AF` (border-gray-400)
  - 过渡时长：150ms
- 中间：会话信息
  - 头像：32px × 32px，圆角50%
  - 会话名称：字体大小14px，字体粗细500，颜色 `#111827` (text-gray-900)
  - 时间戳：字体大小12px，颜色 `#6B7280` (text-gray-500)
- 右侧：操作按钮（编辑、删除）
  - 按钮尺寸：24px × 24px
  - 图标尺寸：14px × 14px
  - 颜色：`#9CA3AF` (text-gray-400)
  - 悬停状态：颜色 `#6B7280` (text-gray-500)
  - 过渡时长：150ms

**选中状态视觉反馈**
- 选中会话项背景色：`#EFF6FF` (blue-50)
- 选中会话项边框：左侧边框 `3px solid #3B82F6` (blue-500)
- 选中文本颜色：`#1E40AF` (text-blue-800)

### 1.2 交互设计

**全选交互**
- 点击全选复选框：选中/取消选中所有会话
- 全选状态：复选框显示勾选标记，背景色 `#3B82F6`
- 部分选中状态：复选框显示减号标记，背景色 `#3B82F6`
- 未选中状态：复选框显示空，背景色 `#FFFFFF`

**单选交互**
- 点击会话项复选框：选中/取消选中单个会话
- 点击会话项其他区域：切换到该会话（不影响选择状态）
- 选中状态：复选框显示勾选标记，背景色 `#3B82F6`

**批量删除交互**
- 点击批量删除按钮：弹出确认对话框
- 确认对话框：
  - 标题："确认删除"
  - 内容："确定要删除选中的 X 个会话吗？此操作不可恢复。"
  - 确认按钮：背景色 `#EF4444`，文字"确认删除"
  - 取消按钮：背景色 `#FFFFFF`，边框 `1px solid #D1D5DB`，文字"取消"
- 删除中：按钮显示加载状态，禁用其他操作
- 删除完成：关闭对话框，刷新会话列表

### 1.3 响应式设计

**移动端（< 768px）**
- 选择栏高度：44px
- 内边距：10px 12px
- 会话项高度：60px
- 内边距：10px 12px
- 复选框尺寸：14px × 14px
- 头像尺寸：28px × 28px
- 会话名称字体大小：13px
- 时间戳字体大小：11px

**平板端（768px - 1024px）**
- 选择栏高度：48px
- 会话项高度：64px
- 复选框尺寸：16px × 16px
- 头像尺寸：32px × 32px
- 会话名称字体大小：14px
- 时间戳字体大小：12px

**桌面端（> 1024px）**
- 选择栏高度：48px
- 会话项高度：64px
- 复选框尺寸：16px × 16px
- 头像尺寸：32px × 32px
- 会话名称字体大小：14px
- 时间戳字体大小：12px

### 1.4 可访问性设计

**键盘导航**
- Tab键：按顺序聚焦到全选复选框、批量删除按钮、会话项复选框
- 空格键/回车键：激活复选框或按钮
- 焦点状态：蓝色边框 `2px solid #3B82F6`，偏移 `2px`

**屏幕阅读器**
- 全选复选框：aria-label="全选会话"
- 会话项复选框：aria-label="选择会话 {会话名称}"
- 批量删除按钮：aria-label="批量删除选中的会话"
- 选中计数：aria-live="polite"

**颜色对比度**
- 文本与背景对比度：最小 4.5:1
- 按钮文字与背景对比度：最小 4.5:1
- 边框与背景对比度：最小 3:1

### 1.5 动画设计

**过渡动画**
- 悬停状态：`transition-colors duration-200 ease-in-out`
- 选中状态：`transition-all duration-200 ease-in-out`
- 删除动画：`transition-opacity duration-300 ease-out`

**加载状态**
- 批量删除按钮：显示旋转图标，旋转时长 1000ms
- 删除中会话项：透明度从 1 到 0，时长 300ms

## 二、聊天新对话创建功能详细设计

### 2.1 布局设计

**新对话按钮布局（位于聊天面板顶部）**
- 位置：聊天面板顶部右侧
- 高度：36px
- 宽度：自适应（最小宽度100px）
- 内边距：8px 16px
- Flex布局：`items-center gap-2`
- 背景色：`#3B82F6` (blue-500)
- 文字颜色：`#FFFFFF` (white)
- 圆角：6px
- 字体大小：14px
- 字体粗细：500 (font-medium)
- 边框：无
- 阴影：`0 1px 2px 0 rgba(0, 0, 0, 0.05)`
- 悬停状态：背景色 `#2563EB` (blue-600)
- 悬停阴影：`0 4px 6px -1px rgba(0, 0, 0, 0.1)`
- 点击状态：背景色 `#1D4ED8` (blue-700)
- 过渡时长：200ms
- 光标：`pointer`
- 禁用状态：背景色 `#93C5FD` (blue-300)，文字颜色 `#FFFFFF`，光标 `not-allowed`

**图标设计**
- 图标类型：PlusOutlined
- 图标尺寸：16px × 16px
- 图标颜色：`#FFFFFF` (white)
- 图标描边：2px

**按钮文字**
- 内容："新建对话"
- 字体大小：14px
- 字体粗细：500 (font-medium)
- 字体颜色：`#FFFFFF` (white)

### 2.2 交互设计

**创建新对话交互**
- 点击新对话按钮：
  1. 调用后端API创建新会话
  2. 更新当前会话ID
  3. 清空消息列表
  4. 清空思考步骤
  5. 刷新历史对话列表
  6. 按钮显示加载状态（旋转图标）
  7. 创建完成后恢复正常状态

**加载状态**
- 按钮显示旋转图标，旋转时长 1000ms
- 按钮文字变为"创建中..."
- 按钮禁用，背景色 `#93C5FD` (blue-300)
- 光标 `not-allowed`

**错误处理**
- 创建失败：显示错误提示，按钮恢复正常状态
- 错误提示：红色背景 `#FEE2E2` (red-100)，文字颜色 `#991B1B` (red-800)
- 提示位置：按钮下方，持续 3000ms

### 2.3 响应式设计

**移动端（< 768px）**
- 按钮高度：32px
- 内边距：6px 12px
- 字体大小：13px
- 图标尺寸：14px × 14px
- 最小宽度：90px

**平板端（768px - 1024px）**
- 按钮高度：36px
- 内边距：8px 16px
- 字体大小：14px
- 图标尺寸：16px × 16px
- 最小宽度：100px

**桌面端（> 1024px）**
- 按钮高度：36px
- 内边距：8px 16px
- 字体大小：14px
- 图标尺寸：16px × 16px
- 最小宽度：100px

### 2.4 可访问性设计

**键盘导航**
- Tab键：聚焦到新对话按钮
- 空格键/回车键：激活按钮
- 焦点状态：蓝色边框 `2px solid #3B82F6`，偏移 `2px`

**屏幕阅读器**
- 按钮：aria-label="创建新对话"
- 加载状态：aria-busy="true"
- 错误提示：aria-live="assertive"

**颜色对比度**
- 按钮文字与背景对比度：4.5:1（白色文字在蓝色背景上）
- 悬停状态对比度：4.5:1

### 2.5 动画设计

**过渡动画**
- 悬停状态：`transition-all duration-200 ease-in-out`
- 点击状态：`transition-all duration-150 ease-out`
- 加载状态：旋转动画 `spin 1000ms linear infinite`

**消息清空动画**
- 消息列表淡出：`opacity 0`，时长 200ms
- 消息列表清空后淡入：`opacity 1`，时长 200ms

## 三、实现步骤

### 3.1 修改 MainLayout.tsx

**添加状态管理**
```typescript
const [selectedSessions, setSelectedSessions] = useState<Set<string>>(new Set())
const [selectAll, setSelectAll] = useState(false)
```

**添加函数**
- `handleSelectSession(sessionId: string)`：处理单个会话选择
- `handleSelectAll()`：处理全选
- `handleBatchDelete()`：处理批量删除
- `isAllSelected()`：判断是否全选
- `isPartiallySelected()`：判断是否部分选中

**修改历史对话抽屉**
- 添加选择栏组件
- 修改会话项，添加复选框
- 添加批量删除按钮

### 3.2 修改 ChatPanel.tsx

**添加新对话按钮**
- 在聊天面板顶部添加新对话按钮
- 使用 PlusOutlined 图标
- 实现按钮样式和交互

**添加函数**
- `handleNewChat()`：创建新对话
- 调用后端API创建新会话
- 更新状态和界面

### 3.3 更新 useChatStore

**添加方法**
- `createNewSession()`：创建新会话
- `clearCurrentSession()`：清空当前会话

### 3.4 后端API

**添加API端点**
- `POST /api/v1/chat/sessions`：创建新会话
- `DELETE /api/v1/chat/sessions/batch`：批量删除会话

## 四、设计原型图

### 4.1 历史对话选择功能原型

**选择栏原型**
```
┌─────────────────────────────────────┐
│ ☑ 已选择 3 项        [批量删除]     │
└─────────────────────────────────────┘
```

**会话项原型（未选中）**
```
┌─────────────────────────────────────┐
│ ☐ [头像] 项目分析讨论    [✏️][🗑️]   │
│        2024-01-15 10:30             │
└─────────────────────────────────────┘
```

**会话项原型（选中）**
```
┌─────────────────────────────────────┐
│ ☑ [头像] 项目分析讨论    [✏️][🗑️]   │
│        2024-01-15 10:30             │
└─────────────────────────────────────┘
```

### 4.2 聊天新对话功能原型

**新对话按钮原型**
```
┌─────────────────────────────────────┐
│                    [+ 新建对话]      │
├─────────────────────────────────────┤
│                                     │
│           消息列表区域               │
│                                     │
├─────────────────────────────────────┤
│ [输入框...]              [发送]     │
└─────────────────────────────────────┘
```

## 五、技术实现细节

### 5.1 组件选择

- 复选框：Ant Design Checkbox
- 按钮：Ant Design Button
- 对话框：Ant Design Modal
- 图标：Ant Design Icons

### 5.2 状态管理

- 使用 React useState 管理选择状态
- 使用 useChatStore 管理会话状态
- 使用 Set 数据结构存储选中的会话ID

### 5.3 样式实现

- 使用 Tailwind CSS 类名
- 遵循 Ant Design 设计规范
- 保持与现有界面风格一致

