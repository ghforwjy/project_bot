# 任务进度自动计算实现计划

## 问题分析

根据用户要求，任务进度不得进行手工修改，一律自动计算。当前实现中存在以下问题：

1. **前端允许手工修改进度**：任务编辑界面中显示了进度输入字段，用户可以直接修改

2. **后端逻辑存在漏洞**：当前端发送进度字段时，后端会跳过自动计算逻辑，即使进度值为0

3. **自动计算逻辑未充分触发**：由于前端总是发送完整的任务数据，包括进度字段，导致后端的自动计算逻辑很少被触发

## 修复计划

### 1. 修改前端代码（ProjectDetailModal.tsx）

- **移除进度编辑功能**：
  - 修改任务列表的进度列渲染逻辑，移除编辑状态的InputNumber组件
  - 始终显示Progress组件，不允许手工输入
  - 从编辑状态数据中移除progress字段的处理

- **优化编辑数据发送**：
  - 确保保存编辑时不发送progress字段，让后端完全控制进度计算

### 2. 修改后端代码（task.py）

- **强制自动计算进度**：
  - 修改update_task函数，移除对progress字段的检查
  - 无论是否接收到progress字段，都强制调用calculate_task_progress函数重新计算进度
  - 确保进度计算逻辑正确处理实际开始/结束日期的变化

### 3. 验证修复结果

- **测试场景**：
  - 设置任务的实际开始日期，验证进度是否自动计算
  - 设置任务的实际结束日期，验证进度是否变为100%
  - 检查任务列表和项目详情中的进度显示是否一致
  - 确认编辑界面不再显示进度输入字段

## 技术细节

- **前端修改**：需要修改ProjectDetailModal.tsx中的taskColumns定义，移除进度字段的编辑功能
- **后端修改**：需要修改task.py中的update_task函数，强制触发进度计算
- **数据流**：前端只发送用户修改的字段（不包括progress），后端接收后根据日期和状态自动计算进度

## 预期结果

- 任务进度完全由系统自动计算，用户无法手工修改
- 设置实际开始日期后，进度会根据时间自动计算
- 设置实际结束日期后，进度会自动变为100%
- 项目进度会根据任务进度的变化自动更新
- 所有界面上的进度显示保持一致