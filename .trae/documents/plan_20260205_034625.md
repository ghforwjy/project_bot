# 修复大模型聊天删除任务失败的问题

## 一、问题分析

### 1.1 原因分析

通过代码分析，发现以下问题：

**后端缺少 delete_task 处理逻辑**：
- `backend/api/chat.py` 中没有处理 `delete_task` 意图的代码
- `backend/core/project_service.py` 中没有 `delete_task` 方法

**前端请求正常**：
- 从截图可以看到，AI 已经正确生成了 `delete_task` 意图和数据
- 数据结构正确：`{"intent": "delete_task", "data": {"project_name": "网站信创改造", "tasks": [{"name": "数据迁移"}]}}`

### 1.2 不涉及的内容

- 不修改前端代码（前端功能正常）
- 不修改后端删除 API（已存在且正常）
- 不修改其他组件

## 二、解决方案

### 2.1 在 project_service.py 中添加 delete_task 方法

**功能**：通过项目名称和任务名称删除任务

**实现**：
- 查找项目
- 查找任务
- 删除任务
- 更新项目概要信息

### 2.2 在 chat.py 中添加 delete_task 处理逻辑

**功能**：处理 AI 生成的 `delete_task` 意图

**实现**：
- 添加 `intent == "delete_task"` 的处理分支
- 调用 `project_service.delete_task()` 方法
- 处理成功和失败的情况

## 三、技术实现细节

### 3.1 修改 project_service.py

**添加 delete_task 方法**：
```python
def delete_task(self, project_name: str, task_name: str) -> Dict:
    """
    删除任务

    Args:
        project_name: 项目名称
        task_name: 任务名称

    Returns:
        Dict: 删除结果
    """
    # 实现删除逻辑
```

### 3.2 修改 chat.py

**添加 delete_task 处理**：
```python
elif intent == "delete_task" and data.get("project_name"):
    tasks = data.get("tasks", [])
    for task in tasks:
        if task.get("name"):
            result = project_service.delete_task(data["project_name"], task["name"])
            # 处理结果
```

## 四、实现步骤

1. **修改 project_service.py**
   - 添加 `delete_task` 方法

2. **修改 chat.py**
   - 添加 `delete_task` 处理逻辑

3. **测试验证**
   - 测试大模型聊天删除任务功能

