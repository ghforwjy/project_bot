# 项目管理功能优化方案

## 问题分析
1. **项目进度和时间计算问题**：项目的起止时间和进度没有根据任务起止时间和进度自动计算，任务本身的进度也没有计算
2. **任务信息展示问题**：项目详情面板没有完全显示每个任务的所有信息，只展示了部分字段
3. **界面布局问题**：项目详情面板目前很窄，查看内容不方便

## 解决方案

### 1. 后端修改：自动计算项目和任务进度

#### 1.1 实现项目进度计算
- **修改 `backend/api/project.py`**：
  - 添加 `calculate_project_progress` 函数，根据项目下所有任务的进度加权平均计算项目进度
  - 添加 `calculate_project_dates` 函数，根据任务的实际开始和结束日期计算项目的起止时间
  - 在任务相关的 API 中（创建、更新、删除任务），自动调用这些函数更新项目数据

#### 1.2 实现任务进度计算
- **修改 `backend/api/task.py`**：
  - 添加 `calculate_task_progress` 函数，根据任务的实际开始和结束日期计算任务进度
  - 在更新任务时，自动调用该函数更新任务进度

### 2. 前端修改：改进项目详情展示

#### 2.1 创建项目详情模态框
- **创建 `ProjectDetailModal.tsx` 组件**：
  - 使用 Ant Design 的 `Modal` 组件，设置为模态弹框
  - 添加拖拽功能，允许用户手工移动弹框位置
  - 改进项目信息展示，确保所有项目字段都能完整显示

#### 2.2 改进任务列表展示
- **在 `ProjectDetailModal.tsx` 中**：
  - 使用 Ant Design 的 `Table` 组件展示任务列表
  - 配置完整的任务字段列，包括：任务名称、描述、负责人、计划开始/结束日期、实际开始/结束日期、进度、状态、优先级、交付物
  - 添加排序和筛选功能，方便用户查看任务

#### 2.3 修改项目面板
- **修改 `ProjectPanel.tsx`**：
  - 移除对 `DetailSidebar` 的引用
  - 添加 `projectDetailModalVisible` 状态，控制项目详情模态框的显示/隐藏
  - 添加 `currentProjectId` 状态，存储当前查看详情的项目ID
  - 修改项目点击事件，打开项目详情模态框

### 3. 技术实现

#### 3.1 后端实现
- **使用 SQLAlchemy 查询**：查询项目下的所有任务
- **进度计算逻辑**：根据任务的进度和权重（如任务的计划时长）计算项目进度
- **时间计算逻辑**：取所有任务中最早的开始日期和最晚的结束日期作为项目的起止时间

#### 3.2 前端实现
- **模态弹框**：使用 Ant Design 的 `Modal` 组件，设置 `modal` 属性为 `true`
- **拖拽功能**：使用 Ant Design 的 `Modal` 组件的 `draggable` 属性或集成 `react-draggable` 库
- **任务列表**：使用 Ant Design 的 `Table` 组件，配置完整的任务字段列
- **数据获取**：使用现有的 React Query 机制，确保数据的实时性

### 4. 预期效果

#### 4.1 功能效果
- **项目进度自动计算**：项目进度会根据任务进度自动更新
- **项目时间自动计算**：项目起止时间会根据任务时间自动调整
- **任务进度自动计算**：任务进度会根据实际时间自动计算
- **完整的任务信息展示**：所有任务字段都能在表格中完整显示
- **灵活的界面交互**：项目详情以模态弹框形式展示，可手工移动位置

#### 4.2 界面效果
- 点击项目列表中的项目，会弹出一个模态弹框显示项目详情
- 弹框可以通过拖拽移动位置，方便用户查看
- 项目详情包括完整的项目信息和以表格形式展示的任务列表
- 任务列表显示所有任务字段，支持排序和筛选

### 5. 实施范围

#### 5.1 后端修改
- `backend/api/project.py`：添加项目进度和时间计算功能
- `backend/api/task.py`：添加任务进度计算功能

#### 5.2 前端修改
- 创建 `frontend/src/components/project/ProjectDetailModal.tsx` 组件
- 修改 `frontend/src/components/project/ProjectPanel.tsx` 组件
- 移除或修改 `frontend/src/components/project/DetailSidebar.tsx` 组件

### 6. 测试验证

#### 6.1 功能测试
- 测试创建任务后项目进度是否自动更新
- 测试更新任务后项目进度是否自动更新
- 测试项目起止时间是否根据任务时间自动调整
- 测试任务进度是否自动计算
- 测试项目详情弹框是否能正常显示和移动
- 测试任务列表是否显示所有字段

#### 6.2 界面测试
- 测试弹框的拖拽功能是否正常
- 测试弹框的大小是否合适，内容是否完整显示
- 测试任务列表的排序和筛选功能是否正常
- 测试不同屏幕尺寸下的显示效果

通过以上解决方案，我们可以实现项目进度和时间的自动计算，改进任务信息的展示，以及提供更灵活、方便的项目详情查看方式。