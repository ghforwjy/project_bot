## 问题总结

### 测试发现

**后端split_ai_content** 返回：
```
analysis = "好的，我来查一下。"
content = "```json\n{}\n```\n查询结果是：xxx"
```

**前端analyzeContent** 解析后：
```
mainContent = "" (JSON之前没有内容)
jsonContent = "{}"
analysisText = "查询结果是：xxx"  ❌
```

**期望**：
```
mainContent = "查询结果是：xxx"  ✅
jsonContent = "{}"
analysisText = ""
```

### 问题原因

1. 当后端返回的content以JSON代码块开头时
2. 前端解析时JSON之前没有内容，导致mainContent为空
3. JSON之后的内容被错误地放入analysisText

### 解决方案

#### 方案A：修改后端split_ai_content
将JSON之后的内容移到analysis中

```python
# 方案A: JSON之后的内容放入analysis
if json_match:
    json_start = json_match.start()
    json_end = json_match.end()
    
    # 分析部分：JSON之前 + 之后的内容
    before = ai_content[:json_start].strip()
    after = ai_content[json_end:].strip()
    analysis = f"{before}\n{after}".strip()
    
    # 正文部分：只有JSON代码块
    content = ai_content[json_start:json_end].strip()
    
    return analysis, content
```

优点：前端逻辑简单
缺点：分析内容可能过长

#### 方案B：修改前端analyzeContent
当JSON在内容开头时，把JSON之后的内容放入mainContent

```javascript
// 方案B: 优化前端解析逻辑
if (jsonMatches) {
  const jsonStr = jsonMatches[0];
  const jsonEndIndex = content.indexOf(jsonStr) + jsonStr.length;
  
  // JSON之前的内容
  let mainContent = content.substring(0, content.indexOf(jsonStr)).trim();
  
  // JSON之后的内容
  let analysisText = content.substring(jsonEndIndex).trim();
  
  // 如果JSON在开头，JSON之后的内容应该作为mainContent
  if (!mainContent && analysisText) {
    mainContent = analysisText;
    analysisText = "";
  }
  
  return { mainContent, jsonContent, analysisText };
}
```

优点：保持后端逻辑不变
缺点：前端逻辑更复杂

### 推荐方案：方案A

修改后端split_ai_content函数：
- JSON之前的内容 → analysis
- JSON代码块 → content
- JSON之后的内容 → analysis

这样：
- content只有JSON代码块
- analysis包含所有自然语言解释

### 修改文件

1. `backend/api/chat.py` - 修改split_ai_content函数

### 测试验证

修改后再次运行测试，验证所有场景都符合预期。