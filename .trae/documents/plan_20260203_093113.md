# 统一实时聊天和历史数据的显示逻辑

## 问题分析
经过仔细检查代码，我发现问题的根本原因是：

1. **后端数据处理问题**：在 `backend/api/chat.py` 文件中，`split_ai_content` 函数会为每个 block 添加 `analysis` 字段，即使 `analysis` 是空字符串，这导致了数据格式的修改

2. **前端解析逻辑问题**：在 `frontend/src/utils/messageParser.ts` 文件中，只要 block 包含 `analysis` 属性，就将其分类为 `ANALYSIS` 类型，不管 `analysis` 内容是什么

3. **数据流向不一致**：
   - 实时聊天时，前端直接使用后端返回的 `content` 字段进行解析
   - 历史数据加载时，前端从 `message_metadata` 解析 `content_blocks`，其中包含了被修改过的数据格式

## 解决方案

### 核心思路
- **统一数据处理流程**：确保实时聊天和历史数据使用相同的数据格式和解析逻辑
- **以实时数据格式为准**：直接保存实时数据格式为历史数据，不进行额外修改
- **简化解析逻辑**：不再尝试兼容包含 `analysis` 属性的老格式 block

### 具体实现步骤

1. **修改后端代码**：
   - 修改 `backend/api/chat.py` 文件中的 `send_message` 函数，不再使用 `split_ai_content` 函数处理 AI 回复
   - 直接将 AI 回复的原始内容保存到数据库，不进行分块处理
   - 确保 `message_metadata` 中保存的数据格式与实时返回的数据格式一致

2. **修改前端代码**：
   - 修改 `frontend/src/utils/messageParser.ts` 文件中的 `parseMessage` 函数，优先使用 `content` 字段进行解析
   - 对于包含 `content_blocks` 的消息，只在 `content` 字段为空时才使用 `content_blocks`
   - 移除对包含 `analysis` 属性的 block 的特殊处理

3. **测试验证**：
   - 创建测试用例，验证实时聊天和历史数据的解析结果一致
   - 确保项目大类信息在两种情况下都被正确显示为 MAIN 类型

## 预期效果
- 实时聊天和历史数据使用相同的数据格式和解析逻辑
- 项目大类信息在刷新后仍然显示为正常的操作结果，而不是错误的分析说明
- 代码逻辑更简洁，更容易维护