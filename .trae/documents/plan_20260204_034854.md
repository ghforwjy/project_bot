# 任务进度条时间显示设计方案

## 问题分析

当前甘特图实现中，任务进度条上没有显示任务的起始时间，用户需要通过时间轴来推断任务的具体时间。这对于快速了解任务时间安排不够直观。

## 解决方案

### 1. 核心设计思路

- **双模式显示**：根据任务条宽度自动切换显示模式
- **内部显示**：当任务条足够宽时，在任务条内部显示时间
- **外部显示**：当任务条很窄时，在任务条外部显示时间
- **工具提示**：鼠标悬停时显示完整的时间信息

### 2. 具体实现方案

#### 2.1 时间格式设计

- **简短格式**：`MM-DD`（月-日），适用于任务条内部显示
- **完整格式**：`YYYY-MM-DD`（年-月-日），适用于工具提示

#### 2.2 显示逻辑

- **宽度阈值**：任务条宽度大于50px时，在内部显示时间
- **外部显示**：任务条宽度小于等于50px时，在左侧外部显示时间
- **位置计算**：根据任务条位置和宽度动态计算时间标签位置

#### 2.3 UI样式设计

- **内部时间**：
  - 字体大小：10px
  - 颜色：白色（与任务条形成对比）
  - 位置：任务条左侧，距左边5px
  - 背景：无
  - 边框：无

- **外部时间**：
  - 字体大小：10px
  - 颜色：#666666（灰色，不干扰主视觉）
  - 位置：任务条左侧10px
  - 背景：无
  - 边框：无

- **工具提示**：
  - 字体大小：12px
  - 颜色：#333333
  - 背景：白色
  - 边框：1px solid #e8e8e8
  - 阴影：轻微阴影

### 3. 代码修改方案

#### 3.1 修改 `renderTask` 函数

1. **计算时间标签位置**：
   - 根据任务条宽度判断使用内部还是外部显示
   - 计算时间标签的具体位置

2. **渲染时间标签**：
   - 内部显示：在任务条上方或内部添加时间文本
   - 外部显示：在任务条左侧添加时间文本

3. **添加工具提示**：
   - 为任务条添加鼠标悬停事件
   - 显示完整的开始和结束时间

#### 3.2 关键代码逻辑

```typescript
// 渲染任务时间标签
const renderTaskTimeLabel = (svg: any, task: any, taskX: number, taskWidth: number, y: number) => {
  const shortStartDate = new Date(task.start).toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
  const fullStartDate = new Date(task.start).toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
  const fullEndDate = new Date(task.end).toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
  
  // 判断使用内部还是外部显示
  if (taskWidth > 50) {
    // 内部显示
    svg.append('text')
      .attr('class', 'gantt-task-time-label')
      .attr('x', taskX + 5)
      .attr('y', y + 4)
      .attr('font-size', '10px')
      .attr('fill', 'white')
      .attr('text-anchor', 'start')
      .text(shortStartDate);
  } else {
    // 外部显示
    svg.append('text')
      .attr('class', 'gantt-task-time-label-external')
      .attr('x', taskX - 10)
      .attr('y', y + 4)
      .attr('font-size', '10px')
      .attr('fill', '#666666')
      .attr('text-anchor', 'end')
      .text(shortStartDate);
  }
};
```

### 4. 测试方案

- **不同宽度测试**：测试不同宽度的任务条，确保时间显示正确切换
- **边界情况测试**：测试任务条宽度刚好等于阈值时的显示效果
- **响应式测试**：测试不同屏幕尺寸下的显示效果
- **用户体验测试**：评估时间显示的可读性和美观性

## 预期结果

- **直观的时间显示**：用户可以直接在任务条上看到任务的起始时间
- **智能的显示切换**：根据任务条宽度自动调整显示方式
- **美观的UI设计**：时间显示与任务条和谐统一
- **良好的用户体验**：鼠标悬停时可以查看完整的时间信息

## 实现步骤

1. **修改 `renderTask` 函数**：添加时间标签渲染逻辑
2. **添加样式定义**：为时间标签添加适当的CSS样式
3. **测试不同场景**：验证在各种情况下的显示效果
4. **优化用户体验**：根据测试结果调整显示逻辑和样式

## 技术要点

- **动态计算**：根据任务条宽度动态计算时间标签位置和显示方式
- **响应式设计**：确保在不同屏幕尺寸下都能正常显示
- **性能优化**：避免过多的DOM操作，保持渲染效率
- **UI美观**：确保时间显示与整体UI风格一致