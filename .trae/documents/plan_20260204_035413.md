# 任务进度条开始和结束时间显示设计方案

## 问题分析

当前甘特图实现中存在以下问题：
1. 只显示开始时间，没有显示结束时间
2. 没有考虑实际时间（actual_start_date, actual_end_date）和计划时间（planned_start_date, planned_end_date）的优先级
3. 任务条很短时时间显示会变得拥挤或不可读
4. 工具提示设计简单，没有区分实际时间和计划时间

## 解决方案

### 1. 时间字段使用策略

#### 1.1 优先级顺序

| 任务状态 | 开始时间优先级 | 结束时间优先级 |
|---------|---------------|---------------|
| 待处理(pending) | planned_start_date | planned_end_date |
| 进行中(active) | actual_start_date → planned_start_date | planned_end_date |
| 已完成(completed) | actual_start_date → planned_start_date | actual_end_date → planned_end_date |
| 延迟(delayed) | actual_start_date → planned_start_date | planned_end_date |
| 已取消(cancelled) | actual_start_date → planned_start_date | actual_end_date → planned_end_date |

#### 1.2 字段映射

- 统一使用 `task.start` 和 `task.end` 作为内部字段名
- 在数据处理阶段进行字段映射
- 添加 `task.timeType` 字段，标识使用的是实际时间还是计划时间

### 2. 双模式时间显示

#### 2.1 基于任务条宽度的显示策略

| 任务条宽度 | 显示方式 | 时间信息 |
|-----------|----------|----------|
| > 90px    | 内部显示 | 开始时间（左侧）+ 结束时间（右侧） |
| 60-90px   | 内部显示 | 只显示开始时间，悬停显示结束时间 |
| 15-60px   | 外部显示 | 开始时间（左侧外部），悬停显示结束时间 |
| ≤ 15px    | 悬停显示 | 只在鼠标悬停时显示完整时间信息 |

#### 2.2 时间格式设计

- **内部显示**：`MM-DD`（月-日），字体大小 10px
- **外部显示**：`MM-DD`（月-日），字体大小 9px
- **悬停显示**：`YYYY-MM-DD`（年-月-日），详细的时间范围

### 3. UI 布局设计

#### 3.1 宽任务条（> 90px）
- **开始时间**：任务条左侧，距左边 8px
- **结束时间**：任务条右侧，距右边 8px
- **样式**：白色文字，带文字阴影，确保在不同颜色的任务条上都清晰可见

#### 3.2 中等宽度任务条（60-90px）
- **开始时间**：任务条左侧，距左边 8px
- **结束时间**：鼠标悬停时显示
- **样式**：白色文字，带文字阴影

#### 3.3 短任务条（15-60px）
- **时间显示**：任务条左侧外部 8px
- **样式**：灰色文字，与背景形成对比

#### 3.4 超短任务条（≤ 15px）
- **时间显示**：只在鼠标悬停时显示
- **样式**：悬停工具提示

### 4. 工具提示设计

#### 4.1 显示内容

- **基本信息**：
  - 任务名称
  - 状态
  - 进度

- **时间信息**：
  - 开始时间：显示实际时间（如果有），否则显示计划时间
  - 结束时间：显示实际时间（如果有），否则显示计划时间
  - 时间类型标识：明确标注使用的是实际时间还是计划时间

#### 4.2 样式

- **背景**：白色，带轻微阴影
- **边框**：1px 灰色边框，圆角 6px
- **文字**：
  - 标题：12px，加粗，深灰色
  - 内容：11px，正常，中灰色
  - 时间类型：10px，正常，浅灰色
- **布局**：清晰的层次结构，适当的间距

### 5. 实现方案

#### 5.1 数据处理优化

1. **后端 API 优化**：
   - 修改 `gantt.py` 中的数据处理逻辑
   - 根据任务状态和时间字段优先级，选择合适的时间字段
   - 添加 `timeType` 字段，标识使用的是实际时间还是计划时间

2. **前端数据处理**：
   - 确保 `task.start` 和 `task.end` 始终有值
   - 检查 `task.timeType` 字段，了解使用的时间类型

#### 5.2 渲染逻辑修改

1. **修改 `renderTask` 函数**：
   - 添加结束时间渲染逻辑
   - 根据任务条宽度选择显示模式
   - 实现不同模式的时间标签渲染

2. **增强工具提示**：
   - 显示完整的时间信息
   - 区分实际时间和计划时间
   - 优化工具提示样式

#### 5.3 样式优化

1. **时间标签样式**：
   - 内部时间：白色文字，文字阴影
   - 外部时间：灰色文字
   - 确保可读性

2. **响应式设计**：
   - 确保在不同屏幕尺寸下都能正常显示
   - 适应任务条宽度变化

### 6. 测试方案

- **不同宽度测试**：测试各种宽度任务条的时间显示效果
- **不同时间字段测试**：测试只有计划时间、只有实际时间、两者都有等情况
- **不同任务状态测试**：测试不同任务状态下的时间显示逻辑
- **响应式测试**：测试不同屏幕尺寸下的显示效果
- **用户体验测试**：评估时间显示的可读性和直观性

## 预期结果

- **完整的时间显示**：用户可以直接看到任务的开始和结束时间
- **智能的时间选择**：根据任务状态自动选择合适的时间字段
- **清晰的时间类型**：区分实际时间和计划时间
- **智能的显示切换**：根据任务条宽度自动调整显示方式
- **美观的 UI 设计**：时间显示与任务条和谐统一
- **良好的用户体验**：在各种情况下都能清晰地查看时间信息

## 实现步骤

1. **后端 API 优化**：修改 `gantt.py`，添加时间字段优先级逻辑
2. **前端数据处理**：确保时间字段正确映射
3. **修改 `renderTask` 函数**：添加结束时间显示逻辑
4. **增强工具提示**：显示完整时间信息和时间类型
5. **样式优化**：确保时间显示美观可读
6. **测试不同场景**：验证各种情况下的显示效果
7. **优化用户体验**：根据测试结果调整设计