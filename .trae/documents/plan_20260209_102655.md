# 修改更新项目状态为刷新项目状态

## 问题分析

1. **意图名称混淆**：当前的 `update_project_status` 意图与 `update_project` 意图容易被大模型混淆，导致意图分析不准确。

2. **功能实现不一致**：当前的 `update_project_status` 意图调用了 `project_service.update_project` 方法，这个方法会更新项目的各种信息，而不仅仅是重新计算项目的时间和完成度。

3. **系统提示词需要更新**：系统提示词中仍然使用的是 `update_project_status`，需要改为 `refresh_project_status`，并明确其作用。

## 解决方案

### 1. 在 `project_service.py` 中添加 `refresh_project_status` 方法

添加一个新的方法 `refresh_project_status`，这个方法只调用 `update_project_summary` 函数来更新项目的进度和时间信息，不更新项目的其他信息。

### 2. 在 `chat.py` 中修改意图处理

- 将 `update_project_status` 意图改为 `refresh_project_status`
- 添加对 `refresh_project_status` 意图的处理，调用 `project_service.refresh_project_status` 方法

### 3. 更新系统提示词

- 在系统提示词的增删改查操作列表中，将 `更新项目状态` 改为 `刷新项目状态`
- 在系统提示词的操作格式说明中，将 `update_project_status` 改为 `refresh_project_status`
- 明确说明 `refresh_project_status` 意图的作用是重新计算项目的时间和完成度

## 具体实现步骤

### 步骤 1：在 `project_service.py` 中添加 `refresh_project_status` 方法

在 `project_service.py` 文件中添加一个新的方法 `refresh_project_status`，这个方法接收项目名称作为参数，找到对应的项目，然后调用 `update_project_summary` 函数来更新项目的进度和时间信息。

```python
def refresh_project_status(self, project_name: str) -> Dict:
    """
    刷新项目状态（重新计算项目的进度和时间信息）

    Args:
        project_name: 项目名称

    Returns:
        Dict: 操作结果
    """
    try:
        # 查找项目
        project = self.db.query(Project).filter(
            Project.name == project_name
        ).first()
        
        if not project:
            return {
                "success": False,
                "message": f"项目 '{project_name}' 不存在",
                "data": None
            }
        
        # 更新项目概要信息
        update_project_summary(project.id, self.db)
        
        # 重新获取项目信息
        self.db.refresh(project)
        
        return {
            "success": True,
            "message": f"项目 '{project_name}' 状态已刷新",
            "data": project.to_dict()
        }
        
    except Exception as e:
        self.db.rollback()
        return {
            "success": False,
            "message": f"刷新项目状态失败: {str(e)}",
            "data": None
        }
```

### 步骤 2：在 `chat.py` 中修改意图处理

- 在 `chat.py` 文件的意图处理逻辑中，将 `update_project_status` 改为 `refresh_project_status`
- 添加对 `refresh_project_status` 意图的处理，调用 `project_service.refresh_project_status` 方法

```python
elif intent == "refresh_project_status" and data.get("project_name"):
    logger.debug(f"处理refresh_project_status意图，项目名称: {data.get('project_name')}")
    result = project_service.refresh_project_status(data["project_name"])
    logger.info(f"刷新项目状态结果: {result}")
    if result["success"]:
        ai_content += f"\n\n操作结果: {result['message']}"
    else:
        ai_content += f"\n\n操作失败: {result['message']}"
```

### 步骤 3：更新 `chat.py` 中的系统提示词

- 在系统提示词的增删改查操作列表中，将 `更新项目状态` 改为 `刷新项目状态`
- 在系统提示词的操作格式说明中，将 `update_project_status` 改为 `refresh_project_status`
- 明确说明 `refresh_project_status` 意图的作用是重新计算项目的时间和完成度

```python
"- 创建项目、更新项目、刷新项目状态、删除项目\n"
```

```python
"### 刷新项目状态操作\n"+
"```json\n"+
"{\n"+
"  \"intent\": \"refresh_project_status\",\n"+
"  \"data\": {\n"+
"    \"project_name\": \"项目名称\"\n"+
"  }\n"+
"}\n"+
"```\n\n"+
"**说明**：refresh_project_status 意图用于重新计算项目的时间和完成度，不更新项目的其他信息。\n\n"+
"### 项目大类操作\n"
```

## 预期效果

1. **意图分析更准确**：使用 `refresh_project_status` 意图名称，大模型能够更准确地理解用户的需求，避免与 `update_project` 意图混淆。

2. **功能实现更符合需求**：`refresh_project_status` 方法只重新计算项目的时间和完成度，不更新项目的其他信息，符合用户的需求。

3. **系统提示更清晰**：更新后的系统提示词能够更清晰地说明 `refresh_project_status` 意图的作用，帮助大模型生成更准确的 JSON 指令。

4. **用户体验更好**：用户可以通过简单的指令刷新项目状态，而不需要担心意外更新项目的其他信息。