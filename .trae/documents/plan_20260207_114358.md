## 实施计划

### 1. 修改 ffmpeg 调用路径
**文件**: `backend/voice/audio_processor.py`
- 修改 `convert_to_wav` 方法，使用项目内 ffmpeg 路径
- 修改 `validate_audio` 方法，使用项目内 ffprobe 路径
- 添加 `FFMPEG_PATH` 配置，支持相对路径调用
- 增加错误处理和日志输出

### 2. 创建部署脚本
**文件**: `setup_voice.py`
- **过程显示**: 每个步骤显示详细进度信息
- **自验证逻辑**: 对每个下载和部署步骤进行验证
- **验证结果显示**: 明确显示成功/失败状态
- **具体功能**:
  1. 下载 ffmpeg 便携版到 `ffmpeg/bin/` 目录
  2. 验证 ffmpeg 可执行文件完整性
  3. 下载 Whisper 模型（medium 版本）到 `voice/models/` 目录
  4. 验证模型文件大小和完整性
  5. 可选：下载 Whisper.cpp 可执行文件
  6. 检查并创建必要的目录结构
  7. 生成部署报告

### 3. 配置豆包语音参数
**文件**: `.env`
- 添加豆包语音配置参数
- 验证参数格式正确性

### 4. 安装 Python 依赖
**文件**: `requirements.txt`
- 添加 `openai-whisper` 依赖
- 添加 `torch` 依赖

### 5. 测试语音服务
**测试步骤**:
1. 运行 `python setup_voice.py` 部署必要文件
2. 启动后端服务
3. 测试 Whisper 语音识别
4. 测试豆包语音识别
5. 验证音频格式转换功能
6. 显示详细测试结果

### 6. 集成到主应用
- 在 `main.py` 中包含语音 API 路由
- 确保启动时初始化语音服务
- 添加健康检查端点

## 部署脚本验证逻辑

### FFMPEG 验证
- ✅ 检查 ffmpeg.exe 和 ffprobe.exe 存在
- ✅ 运行 `ffmpeg -version` 验证可执行性
- ✅ 检查版本号

### WHISPER 模型验证
- ✅ 检查模型文件存在
- ✅ 验证文件大小（medium.bin ~769MB）
- ✅ 检查文件完整性（可选：MD5 校验）

### WHISPER.CPP 验证
- ✅ 检查 main.exe 存在
- ✅ 运行 `main.exe --help` 验证

### 目录结构验证
- ✅ 检查所有必要目录存在
- ✅ 检查文件权限

### 环境配置验证
- ✅ 检查 .env 文件存在
- ✅ 验证豆包语音参数格式

## 技术要点

- **进度显示**: 使用彩色输出，清晰的步骤标识
- **验证机制**: 多层次验证，确保部署质量
- **错误处理**: 详细的错误信息和恢复建议
- **日志记录**: 生成部署日志文件，便于排查问题
- **用户友好**: 提供交互式选择，支持自定义配置

## 预期结果

- ✅ 部署脚本自动下载并配置所有依赖
- ✅ 每个步骤都有明确的验证结果显示
- ✅ 语音服务正常工作
- ✅ 完整的部署报告